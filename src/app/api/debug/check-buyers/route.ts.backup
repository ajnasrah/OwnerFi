import { NextRequest, NextResponse } from 'next/server';
import { FirebaseDB } from '@/lib/firebase-db';

export async function GET(request: NextRequest) {
  try {
    console.log('ðŸ” Checking all buyer links in database...');
    
    // Get all buyer links
    const allBuyerLinks = await FirebaseDB.queryDocuments('buyerLinks', []);
    
    console.log(`ðŸ“Š Found ${allBuyerLinks.length} total buyer links`);
    
    // Filter Dallas buyers specifically
    const dallasBuyers = allBuyerLinks.filter((buyer: any) => 
      buyer.city && buyer.city.toLowerCase().includes('dallas')
    );
    
    console.log(`ðŸŽ¯ Found ${dallasBuyers.length} Dallas buyers`);
    
    const summary = allBuyerLinks.map((buyer: any) => ({
      id: buyer.id,
      name: `${buyer.firstName} ${buyer.lastName}`,
      city: buyer.city,
      state: buyer.state,
      budget: `$${buyer.maxMonthlyPayment}/mo`,
      languages: buyer.languages,
      isAvailable: buyer.isAvailable
    }));
    
    return NextResponse.json({
      totalBuyers: allBuyerLinks.length,
      dallasBuyers: dallasBuyers.length,
      buyers: summary
    });

  } catch (error) {
    console.error('Failed to check buyers:', error);
    return NextResponse.json({ error: 'Failed' }, { status: 500 });
  }
}